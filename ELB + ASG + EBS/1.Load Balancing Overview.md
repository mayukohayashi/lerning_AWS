## What is load balancing

- Load balancers are servers that forward internet traffic to multiple servers (EC2 Instances) downstream.

## Why use a load balancer?

- Spread load across multiple downstream instances
- Expose a single point of access (DNS) to your application
- Seamlessly handle failures of downstream instances
- Do regular health checks to your instances
- Provide SSL termination (HTTPS) for your websites
- Enforce stickiness with cookies
- High availability across zones
- Separate public traffic from private traffic

## Why use an EC2 Load Balancer?

- An ELB (EC2 Load Balancer) is a managed load balancer
  - AWS guarantees that it will be working
  - AWS takes care of upgrades, maintenance, high availability
  - AWS provides only a few configuration knobs
- It costs less to setup your own load balancer but it will be a lot more effort on your end
- It is integrated with many AWS offering / services

## Types of load balancer on AWS

- AWS has 3 kinds of Load Balancers

- Classic Load Balancer (v1 - old generation) - 2009
- Application Load Balancer (v2 - new generation) - 2016
- Network Load Balamcer (v2 - new generation) - 2017
- Overall, it is recommended to use the newer / v2 generation load balancers as they provide more features
- You can setup internal (private) or external (public) ELBs

## Health Checks

- Health Check are crucial for Load Balancers
- They enable the load balancer to know if instances it forwards traffic to are available to reply to requests
- The health check is done on a port and a route (/health is common)
- if the response is not 200 (OK), then the instance is unhealthy

> Classic Load Balancer ============> EC2 instance
> Health checks
> Port 45676
> Route /health

## Application Load Balancer (v2)

- Application load balancer (layer 7) allow to do
  - Load balancing to multiple HTTP applications across machines (target groups)
  - Load balancing to multiple applications on the same machines (ex/ containers)
  - Load balancing based on route in URL
  - Load balancing based on hostname in URL
- Basically, they are awesome for micro service & container-based application (example; Docker & Amazon ECS)
- Has a port mapping feature to redirect to a dynamic port
- In comparison, we would need to create one Classic Load Balancer per application before that was very expensive and inefficient

## Application Load Balancer v2 (ALB) Good to know

- Stickiness can be enabled at the target group level
  - Same request goes to the same instance
  - Stickiness is directly generated by the ALB (not the application)
- ALB support HTTP/HTTPS & Websockets protocol
- The application serves dont see the IP of the client directly
  - The true IP of the client is inserted in the header X-Forwarded-For
  - We can also get Port (X-Forwarded-Port) and proto (X-Forwarded-Proto)

## Network Load Balancer (v2)

- Network load balancers (Layer 4) allow to do:
  - Forward TCP traffic to your instances
  - handle millions of request per seconds
  - Support for static IP or elastic IP
  - Less latency ~ 100ms (vs 400 ms for ALB)
- Network Load Balancers are mostly used for extreme performance and should not to be the default load balancer you choose

# Load Balancer Good to know

- Classic Load Balancers are Deprecated
  - Application Load Balancers for HTTP / HTTPs & Websocket
  - Network Load Balancer for TCP
- CLB and ALB support SSL certifications and provide SSL termination
- All Load Balancers have health check capability
- ALB can route on based on hostname / path
- ALB is a great fit with ECS(Docker)
- Any Load Balancer (CLB, ALB, NLB) has a static host name. Do not resolve and use underlying IP
- LBs can scale but not instantaneously - contact AWS for "warm-up"
- NLB directly see the client IP
- 4xx errors are client induced errors
- 5xx errors are application induced errors
  - Load Balancer Errors 503 means at capacity or no registered target
- If the LB cant connect to your application, check your security groups!
